@page "/measurements-mud-datagrid"
@page "/measurements-paged"
@using Application.Features.Dtos
@using MudBlazor

<PageTitle>Measurements MudDataGrid</PageTitle>

<MudPaper Class="pa-4" Style="width:50%; margin: 0 auto;">
    <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center">
        <MudSelect T="string" Label="Location" Dense="true" Clearable="true"
                   Value="@_selectedLocation" ValueChanged="OnLocationChanged" Style="min-width: 220px">
            @foreach (var loc in _locations)
            {
                <MudSelectItem T="string" Value="@loc">@loc</MudSelectItem>
            }
        </MudSelect>

        <MudSelect T="string" Label="Name" Dense="true" Clearable="true"
                   Disabled="@string.IsNullOrWhiteSpace(_selectedLocation)"
                   Value="@_selectedName" ValueChanged="OnNameChanged" Style="min-width: 220px">
            @foreach (var nm in _availableNames)
            {
                <MudSelectItem T="string" Value="@nm">@nm</MudSelectItem>
            }
        </MudSelect>

        @if (!string.IsNullOrWhiteSpace(_selectedLocation) && !string.IsNullOrWhiteSpace(_selectedName))
        {
            <MudText Typo="Typo.body2">Selected: @_selectedLocation - @_selectedName</MudText>
        }
    </MudStack>
</MudPaper>

@if (!string.IsNullOrWhiteSpace(_error))
{
    <MudAlert Severity="Severity.Error" Class="mt-4">@_error</MudAlert>
}

<MudPaper Class="pa-2 mt-4" Style="width:50%; margin: 0 auto;">
    <MudDataGrid T="GetMeasurementDto"
                 @ref="_grid"
                 Bordered="true"
                 Dense="true"
                 Hover="true"
                 ServerData="LoadServerData"
                 PageSizeOptions="new int[] { 10, 20, 50, 100 }"
                 RowsPerPage="20">
        <Columns>
            <TemplateColumn T="GetMeasurementDto" Title="Date">
                <CellTemplate Context="ctx">@ctx.Item.Timestamp.ToLocalTime().ToString("dd.MM.yyyy")</CellTemplate>
            </TemplateColumn>
            <TemplateColumn T="GetMeasurementDto" Title="Time">
                <CellTemplate Context="ctx">@ctx.Item.Timestamp.ToLocalTime().ToString("HH:mm:ss")</CellTemplate>
            </TemplateColumn>
            <TemplateColumn T="GetMeasurementDto" Title="Value">
                <CellTemplate Context="ctx">
                    <div style="text-align:right">@ctx.Item.Value.ToString("F2")</div>
                </CellTemplate>
            </TemplateColumn>
        </Columns>
        <PagerContent>
            @if (_totalItems > 0)
            {
                <MudDataGridPager T="GetMeasurementDto" />
            }
        </PagerContent>
    </MudDataGrid>
</MudPaper>
